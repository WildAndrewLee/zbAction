!function(a,b){var c=function(){return this instanceof c?void(this._events={}):new c};c.prototype._ws=null,c.prototype._onload=null,c.prototype.on=function(a,b){if(!a)throw"No event specified.";if(!b)throw"No callback specified.";this._events[a]=this._events[a]||[],this._events[a].push(b)},c.prototype.off=function(a,c){if(a&&a in this._events!=!1){if(c===b)return void delete this._events[a];var d=this._events[a].indexOf(c);this._events[a].splice(d,1)}},c.prototype.emit=function(a){if(a&&a in this._events!=!1)for(var b=0;b<this._events[a].length;b++){var c=this._events[a][b],d=Array.prototype.slice.call(arguments,1);c.apply(this,d)}},c.prototype.load=function(a){this._ws=new WebSocket(a);var b=this;this._ws.onopen=function(){b._onload&&b._onload.apply(b,arguments)},this._ws.onmessage=function(a){var c=JSON.parse(a.data);b.emit(c.event,c)}},c.prototype.onload=function(a){this._onload=a},c.prototype.send=function(a){if(!this._ws)throw"You must connect to a websocket first.";this._ws.send(JSON.stringify(a))},a.Socket=c}(window),function(a,b,c){var d,e;-1!==location.href.indexOf("localhost:4242")?(d="ws://localhost:4242/sync",e="http://localhost:4242/mods/list/"):(d="ws://zbaction.reticent.io/sync",e="http://zbaction.reticent.io/mods/list/");var f={board_key:__zbAction.board_key,uid:$.zb.stat.mid,name:"andrew"},g=function(){if(!(this instanceof g))return new g;var a=b(),c=this;this._wait=[],a.onload(function(){a.send({key:0,type:"handshake",data:f})}),a.load(d);var h=function(b,c,d){if(!l.hasOwnProperty(c)){var e=this;a.on(b+"."+c,function(a){console.log("received msg from "+b+"."+c),console.log(a),a.event=a.event.replace(b+".",""),d.call(e,a)})}},i=function(a,b){this.send=a.bind(null,b),this.register=h.bind(this,b)},j=function(a){for(var b=a.mods||[],d=0;d<c._wait.length;d++){var e=c._wait[d];-1!==b.indexOf(e.key)&&e.fn.call(null,new i(k,e.key))}},k=null,l={handshake:function(b){var c=b.details;k=function(b,d){try{if(d.receiver.board_key||(d.receiver.board_key=f.board_key),d.receiver.board_key!==f.board_key)throw new Error("Cross-board requests are not allowed.");d.details instanceof Object&&(d.details=JSON.stringify(d.details)),d={event:b+"."+d.event,details:d.details,source:f,receiver:{uid:parseInt(d.receiver.uid),board_key:d.receiver.board_key}}}catch(e){if("TypeError"===e.name)throw new Error("Invalid action data provided.");throw e}a.send({key:c,mod_key:b,type:"action",data:d})},$.getJSON(e+__zbAction.board_key,j)}};for(var m in l)l.hasOwnProperty(m)&&a.on(m,l[m])};g.prototype.ready=function(a,b){if("string"!=typeof a)throw"You must specify an API key.";if("function"!=typeof b)throw"You must specify a function.";this._wait.push({key:a,fn:b})},a.zbAction=new g}(window,Socket);