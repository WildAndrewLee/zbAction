!function(a,b){var c=function(){return this instanceof c?void(this._events={}):new c};c.prototype._ws=null,c.prototype._onload=null,c.prototype.on=function(a,b){if(!a)throw"No event specified.";if(!b)throw"No callback specified.";this._events[a]=this._events[a]||[],this._events[a].push(b)},c.prototype.off=function(a,c){if(a&&a in this._events!=!1){if(c===b)return void delete this._events[a];var d=this._events[a].indexOf(c);this._events[a].splice(d,1)}},c.prototype.emit=function(a){if(a&&a in this._events!=!1)for(var b=0;b<this._events[a].length;b++){var c=this._events[a][b],d=Array.prototype.slice.call(arguments,1);c.apply(this,d)}},c.prototype.load=function(a){this._ws=new WebSocket(a);var b=this;this._ws.onopen=function(){b._onload&&b._onload.apply(b,arguments)},this._ws.onmessage=function(a){var c=JSON.parse(a.data);b.emit(c.event,c)}},c.prototype.onload=function(a){this._onload=a},c.prototype.send=function(a){if(!this._ws)throw"You must connect to a websocket first.";this._ws.send(JSON.stringify(a))},a.Socket=c}(window),function(a,b,c){var d,e,f;-1!==location.href.indexOf("localhost:")?(d="ws://localhost:4242/sync",e="http://localhost:4343/api/mods/list/",f="http://localhost:4343/api/users/list/"):(d="ws://zba.reticent.io/sync",e="http://zbaction.reticent.io/api/mods/list/",f="http://zbaction.reticent.io/api/users/list/");var g={board_key:a.__zbAction.board_key,bpath:$.zb.stat.bpath,uid:$.zb.stat.mid,name:"andrew"},h={},i={by_uid:function(a){return a=""+a,h[a]||null},by_name:function(a){for(var b in h)if(h[b]===a)return b;return null}};delete a.__zbAction;var j=function(){if(!(this instanceof j))return new j;var a=b(),c=this;this._wait=[],a.onload(function(){a.send({key:0,type:"handshake",data:g})}),a.load(d);var k=function(b,c,d){if(!o.hasOwnProperty(c)){var e=this;a.on(b+"."+c,function(a){a.event=a.event.replace(b+".",""),d.call(e,a)})}},l=function(a,b){this.send=a.bind(null,b),this.register=k.bind(this,b),this.users=i},m=function(b){var d=b.mods||[];for(var e in c._wait)-1!==d.indexOf(e)&&c._wait[e].call(null,new l(n,e));a.send({key:0,type:"get_unread",data:g})},n=null,o={handshake:function(b){if(null===n){var c=b.details;n=function(b,d){try{if(d.receiver.board_key||(d.receiver.board_key=g.board_key),d.receiver.board_key!==g.board_key)throw new Error("Cross-board requests are not allowed.");d.details=JSON.stringify(d.details),d={event:(b+"."+d.event).substring(0,255),details:d.details.substring(0,1e4),source:g,timestamp:d.timestamp,receiver:{uid:parseInt(d.receiver.uid),board_key:d.receiver.board_key}}}catch(e){if("TypeError"===e.name)throw new Error("Invalid action data provided.");throw e}a.send({key:c,mod_key:b,type:"action",data:d})},$.getJSON(f+g.board_key,function(a){h=a.users}).done(function(){$.getJSON(e+g.board_key,m)})}}};for(var p in o)o.hasOwnProperty(p)&&a.on(p,o[p])};j.prototype.ready=function(a,b){if("string"!=typeof a)throw"You must specify an API key.";if("function"!=typeof b)throw"You must specify a function.";this._wait[a]=b},a.zbAction=new j}(window,Socket);